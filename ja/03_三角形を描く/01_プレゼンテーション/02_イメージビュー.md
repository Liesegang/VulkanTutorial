スワップチェインにあるものも含め、レンダーパイプラインで `VkImage` を使用するには、`VkImageView` オブジェクトを作成しなければなりません。イメージビューとは、文字通り画像の中を見ることです。画像へのアクセス方法や、画像のどの部分にアクセスするかを記述します。例えば、ミップマッピングレベルなしで2Dテクスチャのデプステクスチャとして扱うなどです。

この章では、`createImageViews`関数を実装します。その関数内で、スワップチェーン内のすべての画像が後にカラーターゲットとして使えるように、それぞれの画像に対して基本的なイメージビューを作成します。

まず、イメージビューを格納するクラスメンバを追加します。

```c++
std::vector<VkImageView> swapChainImageViews;
```

`createImageViews` 関数を作成し、スワップチェーンを作成したすぐ後に呼び出します。

```c++
void initVulkan() {
    createInstance();
    setupDebugMessenger();
    createSurface();
    pickPhysicalDevice();
    createLogicalDevice();
    createSwapChain();
    createImageViews();
}

void createImageViews() {

}
```

まず最初に行う必要があるのは、これから作成するすべてのイメージビューの数に合うようにリストのサイズを変更することです。

```c++
void createImageViews() {
    swapChainImageViews.resize(swapChainImages.size());

}
```

次に、スワップチェーンのすべての画像を反復処理するループを作ります。

```c++
for (size_t i = 0; i < swapChainImages.size(); i++) {

}
```

イメージビューを作成するためのパラメータは `VkImageViewCreateInfo` 構造体で指定します。最初のいくつかのパラメータは簡単です。

```c++
VkImageViewCreateInfo createInfo{};
createInfo.sType = VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO;
createInfo.image = swapChainImages[i];
```

`viewType` と `format` フィールドは画像データの種類を指定します。`viewType` パラメータでは、画像を1次元テクスチャ、2次元テクスチャ、3次元テクスチャ、キューブマップが選択できます。

```c++
createInfo.viewType = VK_IMAGE_VIEW_TYPE_2D;
createInfo.format = swapChainImageFormat;
```

`components` フィールドでは、カラーチャンネルの周りをスウィズリング(ベクトルの要素を入れ替えること)することができます。例えば、すべてのチャンネルを赤チャンネルにマップしてモノクロのテクスチャを作成することができます。また、`0` や `1` の定数値をチャンネルにマップすることもできます。ここではデフォルトのマッピングを使います。

```c++
createInfo.components.r = VK_COMPONENT_SWIZZLE_IDENTITY;
createInfo.components.g = VK_COMPONENT_SWIZZLE_IDENTITY;
createInfo.components.b = VK_COMPONENT_SWIZZLE_IDENTITY;
createInfo.components.a = VK_COMPONENT_SWIZZLE_IDENTITY;
```

`subresourceRange` フィールドには、画像の目的と、画像のどの部分にアクセスするかを指定します。私たちの画像は、ミップマッピングレベルや複数のレイヤーを使用せずに、カラーターゲットとして使用されます。

```c++
createInfo.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;
createInfo.subresourceRange.baseMipLevel = 0;
createInfo.subresourceRange.levelCount = 1;
createInfo.subresourceRange.baseArrayLayer = 0;
createInfo.subresourceRange.layerCount = 1;
```

ステレオグラフィック 3D アプリケーションを作成する場合は、複数のレイヤーを持つスワップチェーンを作成します。そうすれば、異なるレイヤーにアクセスすることで、左右の目のビューを表す画像ごとに複数のイメージビューを作成することができます。

`vkCreateImageView`を呼び出してイメージビューを作成します。

```c++
if (vkCreateImageView(device, &createInfo, nullptr, &swapChainImageViews[i]) != VK_SUCCESS) {
    throw std::runtime_error("failed to create image views!");
}
```

画像とは異なり、イメージビューは明示的に自分で作成したものなので、プログラムの最後に同様にループを追加して破棄する必要があります。

```c++
void cleanup() {
    for (auto imageView : swapChainImageViews) {
        vkDestroyImageView(device, imageView, nullptr);
    }

    ...
}
```

イメージビューは、イメージをテクスチャとして使用するには十分ですが、レンダーターゲットとして使用するにはまだ準備が不十分です。そのためには、フレームバッファとして知られているもう一つのステップが必要になります。しかし、その前に[グラフィックパイプラインを設定](!ja/三角形を描く/グラフィックスパイプラインの基礎/導入)しなければなりません。

[C++ コード](/code/07_image_views.cpp)
